version: '2'

services:
  server:
    build: ./kansa/server
    env_file: ./kansa/server/dev.env
    entrypoint: ./wait-for-it.sh postgres:5432 -- npm start
    links:
      - postgres
    ports:
      - "3000:3000"
    restart: always

  postgres:
    image: postgres:9.5
    env_file: ./postgres/dev.env
    expose:
      - "5432"
    restart: always
    volumes:
      - pgdata:/pgdata
      - ./postgres/damm:/damm:ro
      - ./postgres/init:/docker-entrypoint-initdb.d:ro

volumes:
  pgdata:
